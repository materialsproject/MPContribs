# =============================================================================
# A-Lab Analysis Registry
# =============================================================================
# Documentation for available analysis plugins.
# Analyses are auto-discovered from data/analyses/*.py
#
# This file serves as:
# 1. Documentation of available analyses
# 2. Default configuration for each analysis
# 3. Template for adding new analyses
# =============================================================================

# Built-in analyses (always available)
analyses:
  xrd_dara:
    description: 'XRD phase identification using DARA'
    class: XRDAnalyzer
    file: base_analyzer.py
    cli_flag: '--xrd'
    output_parquet: xrd_refinements.parquet, xrd_phases.parquet
    default_config:
      wmin: 10 # Minimum 2-theta angle
      wmax: 80 # Maximum 2-theta angle
      save_viz: false # Save visualization images
    outputs:
      - xrd_success: 'Whether analysis succeeded'
      - xrd_rwp: 'Weighted profile R-factor'
      - xrd_num_phases: 'Number of phases identified'
      - xrd_error: 'Error message if failed'
    requirements:
      - experiments.parquet (with xrd_sampleid_in_aeris)
      - xrd_data_points.parquet (optional, for patterns)
    notes: |
      Uses DARA (Deep Analysis for Rietveld Automation) for automated
      phase identification. Requires MP API key for CIF downloads.
      Results stored in data/xrd_creation/results/

  powder_statistics:
    description: 'Calculate powder dosing statistics'
    class: PowderStatisticsAnalyzer
    file: base_analyzer.py
    cli_flag: '--powder-stats'
    output_parquet: null # Results merged into main output
    default_config: {}
    outputs:
      - powder_avg_accuracy: 'Average dosing accuracy %'
      - powder_total_doses: 'Total number of doses'
      - powder_unique_count: 'Number of unique powders'
      - powder_total_mass_g: 'Total powder mass in grams'
    requirements:
      - experiments.parquet
      - powder_doses.parquet
    notes: |
      Calculates statistics about powder dosing accuracy.
      Fast analysis, recommended for all products.

# =============================================================================
# Adding a New Analysis
# =============================================================================
# To add a new analysis (e.g., SEM clustering):
#
# 1. Create the analyzer file:
#    data/analyses/sem_analyzer.py
#
# 2. Define the analyzer class:
#    ```python
#    from base_analyzer import BaseAnalyzer
#
#    class SEMAnalyzer(BaseAnalyzer):
#        name = "sem_clustering"
#        description = "Cluster SEM images by morphology"
#        cli_flag = "--sem"
#
#        def analyze(self, experiments_df, parquet_dir):
#            # Your analysis logic here
#            results = []
#            for _, exp in experiments_df.iterrows():
#                # Process each experiment
#                results.append({
#                    'experiment_name': exp['name'],
#                    'cluster_id': compute_cluster(exp),
#                    'morphology_score': compute_score(exp)
#                })
#            return pd.DataFrame(results)
#
#        def get_output_schema(self):
#            return {
#                'cluster_id': {'type': 'int', 'required': True},
#                'morphology_score': {'type': 'float', 'required': False}
#            }
#    ```
#
# 3. Document here (optional):
#    sem_clustering:
#      description: "Cluster SEM images by morphology"
#      class: SEMAnalyzer
#      file: sem_analyzer.py
#      ...
#
# 4. The analysis will be auto-discovered on next pipeline run
# =============================================================================

# Placeholder for future analyses
# Uncomment and modify when adding:

# sem_clustering:
#   description: "Cluster SEM images by morphology"
#   class: SEMAnalyzer
#   file: sem_analyzer.py
#   cli_flag: "--sem"
#   default_config:
#     num_clusters: 5
#     feature_extraction: "resnet50"
#   outputs:
#     - cluster_id: "Cluster assignment"
#     - morphology_score: "Morphology similarity score"
#   requirements:
#     - SEM images in experiments/*/SEM images/
#   notes: |
#     Uses computer vision to cluster SEM images.
#     Requires tensorflow/pytorch.

# heating_profile:
#   description: "Analyze heating profile characteristics"
#   class: HeatingProfileAnalyzer
#   file: heating_analyzer.py
#   cli_flag: "--heating"
#   default_config: {}
#   outputs:
#     - heating_rate_avg: "Average heating rate"
#     - overshoot_celsius: "Temperature overshoot"
#     - time_at_target: "Time at target temperature"
#   requirements:
#     - temperature_logs.parquet

