# =============================================================================
# A-Lab Pipeline Default Configuration
# =============================================================================
# This file contains global defaults for the pipeline.
# Product-specific configs can override these values.
#
# Configuration Priority:
#   1. Environment variables (highest - for deployment/secrets)
#   2. This YAML file (middle - for general config)
#   3. Code defaults (lowest - fallback only)
#
# Environment Variables (see .env.example for full list):
#   ALAB_MONGO_URI, ALAB_MONGO_DB, ALAB_MONGO_COLLECTION
#   ALAB_S3_BUCKET, ALAB_S3_PREFIX
#   ALAB_MP_API_KEY
#
# To customize: Either set env vars OR copy values to your product's config.yaml
# =============================================================================

# Pipeline version
version: '2.0'

# MongoDB connection (used by mongodb_to_parquet.py)
# Override with: ALAB_MONGO_URI, ALAB_MONGO_DB, ALAB_MONGO_COLLECTION
mongodb:
  uri: 'mongodb://localhost:27017/'
  database: 'temporary'
  collection: 'release'

# Parquet transformation defaults
# Override with: ALAB_SKIP_TEMP_LOGS, ALAB_SKIP_XRD_POINTS, etc.
parquet:
  # Skip large arrays by default for faster processing
  skip_temperature_logs: false
  skip_xrd_points: false
  skip_workflow_tasks: false
  # Compression settings
  compression: 'snappy'
  engine: 'pyarrow'

# Default experiment filter (can be overridden per product)
experiment_filter:
  # Status filter (completed experiments by default)
  status:
    - completed
  # Require XRD data by default
  has_xrd: true
  # No date range by default (all dates)
  date_range: null

# Analysis defaults
analyses:
  # XRD analysis settings
  xrd_dara:
    enabled: true
    config:
      wmin: 10
      wmax: 80
      save_viz: false

  # Powder statistics (always fast, recommend enabling)
  powder_statistics:
    enabled: true
    config: {}

# Upload settings
# Override with: ALAB_S3_BUCKET, ALAB_S3_PREFIX, ALAB_S3_EXCLUDE_LARGE
upload:
  # S3 bucket for OpenData uploads
  s3_bucket: 'materialsproject-contribs'
  s3_prefix: 'alab_synthesis'
  # Skip large files by default
  exclude_large_files: true
  large_file_threshold_mb: 50

# Diagram generation
diagram:
  # Generate diagram after parquet creation
  auto_generate: true
  # Output formats
  formats:
    - summary # Markdown summary
    - mermaid # ERD diagram
  # Output filename (relative to product directory)
  output_file: 'SCHEMA_DIAGRAM.md'

# Validation settings
validation:
  # Sample size for row-by-row validation (full validation can be slow)
  sample_size: 100
  # Fail pipeline on validation errors
  fail_on_error: false
  # Show first N errors
  max_errors_shown: 10
